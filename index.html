<!-- Actualiza la importación de Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const articlesContainer = document.getElementById('articles-container');
        
        // Configuración de Supabase
        const SUPABASE_URL = 'https://hkvkwwxwrkxckmxmvcdl.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhrdmt3d3h3cmt4Y2tteG12Y2RsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5MDg3MjIsImV4cCI6MjA2MDQ4NDcyMn0.dxOFrOk5GhGJnypRN7TtMcue2TbG-KchsF8WMTVAWNM';
        
        try {
            console.log('Inicializando Supabase...');
            // Usa createClient correctamente
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            
            console.log('Cliente creado, intentando consulta...');
            
            // Función para mostrar artículos
            function displayArticles(articles) {
                if (!articles || articles.length === 0) {
                    articlesContainer.innerHTML = '<div class="col-12"><div class="error-message">No se encontraron artículos disponibles.</div></div>';
                    return;
                }
                
                let articlesHTML = '';
                const domain = 'https://www.rehistoria.com';
                
                articles.forEach(article => {
                    const fullUrl = article.permalink.startsWith('http') ? article.permalink : `${domain}${article.permalink}`;
                    articlesHTML += `
                        <div class="col-md-4 col-sm-6 mb-4">
                            <a href="${fullUrl}" class="article-card-link">
                                <div class="article-card">
                                    <img src="${article.image}" alt="${article.title}" class="article-img" onerror="this.src='https://via.placeholder.com/640x360'">
                                    <div class="article-info">
                                        <span class="category-badge">Artículo</span>
                                        <h3 class="article-title">${article.title}</h3>
                                        <div class="article-meta">
                                            <span>Por INFCAB</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    `;
                });
                
                articlesContainer.innerHTML = articlesHTML;
            }
            
            // Consulta los artículos
            supabaseClient
                .from('articulos')
                .select('id, title, permalink, image')
                .order('id', { ascending: false })
                .limit(30)
                .then(response => {
                    console.log('Respuesta completa:', response);
                    if (response.error) {
                        throw new Error(`Error de Supabase: ${response.error.message}`);
                    }
                    
                    console.log('Datos recibidos:', response.data);
                    displayArticles(response.data);
                })
                .catch(err => {
                    console.error('Error en la consulta:', err);
                    articlesContainer.innerHTML = `
                        <div class="col-12">
                            <div class="error-message">
                                Error al cargar artículos: ${err.message}
                            </div>
                        </div>
                    `;
                });
                
        } catch (err) {
            console.error('Error de inicialización:', err);
            articlesContainer.innerHTML = `
                <div class="col-12">
                    <div class="error-message">
                        Error al inicializar: ${err.message}
                    </div>
                </div>
            `;
        }
    });
</script>